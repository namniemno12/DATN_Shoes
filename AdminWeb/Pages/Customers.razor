@page "/customers"
@inject AdminWeb.Services.UserService UserService
@inject AdminWeb.Services.ToastService Toast
@using AdminWeb.Models

<PageTitle>Khách hàng - Asion Shop</PageTitle>

<link href="css/users.css" rel="stylesheet" />
<link href="css/modal-styles.css" rel="stylesheet" />

<div class="users-page space-y-8">
    <!-- Stats Row -->
    <div class="stat-row">
        <div class="stat-card total">
            <div class="icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" width="24" height="24" fill="currentColor">
                    <path d="M144 0a80 80 0 1 1 0 160A80 80 0 1 1 144 0zM512 0a80 80 0 1 1 0 160A80 80 0 1 1 512 0zM0 298.7C0 239.8 47.8 192 106.7 192h42.7c15.9 0 31 3.5 44.6 9.7c-1.3 7.2-1.9 14.7-1.9 22.3c0 38.2 16.8 72.5 43.3 96c-.2 0-.4 0-.7 0H21.3C9.6 320 0 310.4 0 298.7zM405.3 320c-.2 0-.4 0-.7 0c26.6-23.5 43.3-57.8 43.3-96c0-7.6-.7-15-1.9-22.3c13.6-6.3 28.7-9.7 44.6-9.7h42.7C592.2 192 640 239.8 640 298.7c0 11.8-9.6 21.3-21.3 21.3H405.3zM224 224a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zM128 485.3C128 411.7 187.7 352 261.3 352H378.7C452.3 352 512 411.7 512 485.3c0 14.7-11.9 26.7-26.7 26.7H154.7c-14.7 0-26.7-11.9-26.7-26.7z"/>
                </svg>
            </div>
            <div class="info">
                <p>Tổng khách hàng</p>
                <h4>@totalRecords</h4>
            </div>
        </div>
        <div class="stat-card active">
            <div class="icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="24" height="24" fill="currentColor">
                    <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"/>
                </svg>
            </div>
            <div class="info">
                <p>Đang hoạt động</p>
                <h4>@customers.Count(u => u.Status == 1)</h4>
            </div>
        </div>
        <div class="stat-card locked">
            <div class="icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="22" height="22" fill="currentColor">
                    <path d="M144 144v48H304V144c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192V144C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64H80z"/>
                </svg>
            </div>
            <div class="info">
                <p>Bị khóa</p>
                <h4>@customers.Count(u => u.Status == 0)</h4>
            </div>
        </div>
    </div>

    <!-- Filter Bar -->
    <div class="filter-bar enhanced">
        <div class="filter-inner">
            <h2 class="filter-title">Danh sách khách hàng</h2>
            <div class="flex items-center gap-3 flex-wrap">
                <div class="relative filter-input-wrapper">
                    <input type="text" @bind="searchKeyword" @bind:event="oninput" @onkeydown="HandleKeyDown" class="filter-input" placeholder="Tìm tên, email, SĐT..." />
                    <button type="button" @onclick="SearchCustomers" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600" aria-label="Tìm kiếm">
                        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="14" height="14" fill="currentColor"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></svg>
                    </button>
                    @if (!string.IsNullOrWhiteSpace(searchKeyword))
                    {
                        <button type="button" class="filter-clear-btn" @onclick="ClearSearch">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" width="12" height="12" fill="currentColor"><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>
                        </button>
                    }
                </div>
                <select @bind="filterStatus" class="filter-select">
                    <option value="">Tất cả trạng thái</option>
                    <option value="1">Hoạt động</option>
                    <option value="0">Đã khóa</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Customers Table -->
    <div class="users-panel full-width-edge">
        <div class="relative flex flex-col bg-white shadow-xl rounded-none md:rounded-2xl">
            <div class="flex-auto p-6">
                @if (loading)
                {
                    <div class="flex items-center justify-center py-20">
                        <div class="animate-spin rounded-full h-14 w-14 border-t-2 border-b-2 border-cyan-500"></div>
                    </div>
                }
                else
                {
                    <div class="overflow-x-auto rounded-lg border border-gray-200 bg-white shadow-sm">
                        <table class="users-table w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0 z-10">
                                <tr>
                                    <th scope="col" class="px-5 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Khách hàng</th>
                                    <th scope="col" class="px-5 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Email</th>
                                    <th scope="col" class="px-5 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Số điện thoại</th>
                                    <th scope="col" class="px-5 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Ngày tham gia</th>
                                    <th scope="col" class="px-5 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Trạng thái</th>
                                    <th scope="col" class="px-5 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Thao tác</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100 bg-white">
                                @foreach (var customer in customers)
                                {
                                    <tr class="group hover:bg-gray-50 transition">
                                        <td class="px-5 py-4">
                                            <div class="flex items-center gap-3">
                                                <div class="flex-shrink-0">
                                                    @if (!string.IsNullOrEmpty(customer.Picture))
                                                    {
                                                        <img src="@customer.Picture" alt="@customer.UserName" class="w-10 h-10 rounded-full object-cover" />
                                                    }
                                                    else
                                                    {
                                                        <div class="w-10 h-10 rounded-full bg-cyan-600 flex items-center justify-center text-white text-sm font-semibold">
                                                            @GetInitials(customer.UserName)
                                                        </div>
                                                    }
                                                </div>
                                                <div>
                                                    <p class="text-sm font-semibold text-gray-900">@customer.UserName</p>
                                                    <p class="text-xs text-gray-500">ID: @customer.Id</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-5 py-4">
                                            <p class="text-sm text-gray-800">@customer.Email</p>
                                        </td>
                                        <td class="px-5 py-4">
                                            <p class="text-sm text-gray-800">@customer.PhoneNumber</p>
                                        </td>
                                        <td class="px-5 py-4">
                                            <p class="text-sm text-gray-800">@customer.CreatedAt.ToString("dd/MM/yyyy")</p>
                                            <p class="text-xs text-gray-500">@customer.CreatedAt.ToString("HH:mm")</p>
                                        </td>
                                        <td class="px-5 py-4 text-center">
                                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold @GetStatusClass(customer.Status)">
                                                @GetStatusText(customer.Status)
                                            </span>
                                        </td>
                                        <td class="px-5 py-4 text-center">
                                            <div class="flex items-center justify-center gap-1">
                                                <button @onclick="() => OpenDetailModal(customer)" class="action-btn btn-view" title="Chi tiết">
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="16" height="16" fill="currentColor"><path d="M572.52 241.4C518.9 135.59 407.81 64 288 64 168.19 64 57.1 135.59 3.48 241.4a32.35 32.35 0 0 0 0 29.2C57.1 376.41 168.19 448 288 448c119.81 0 230.9-71.59 284.52-177.4a32.35 32.35 0 0 0 0-29.2zM288 400c-97 0-176-79-176-176S191 48 288 48s176 79 176 176-79 176-176 176zm0-304a128 128 0 1 0 128 128A128 128 0 0 0 288 96z"/></svg>
                                                </button>
                                                @if (customer.Status == 1)
                                                {
                                                    <button @onclick="() => ConfirmStatusChange(customer, 0)" class="action-btn btn-reject" title="Khóa tài khoản">
                                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="14" height="14" fill="currentColor"><path d="M144 144v48H304V144c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192V144C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64H80z"/></svg>
                                                    </button>
                                                }
                                                else
                                                {
                                                    <button @onclick="() => ConfirmStatusChange(customer, 1)" class="action-btn btn-accept" title="Mở khóa">
                                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="14" height="14" fill="currentColor"><path d="M352 144c0-44.2 35.8-80 80-80s80 35.8 80 80v48c0 17.7 14.3 32 32 32s32-14.3 32-32V144C576 64.5 511.5 0 432 0S288 64.5 288 144v48H64c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V256c0-35.3-28.7-64-64-64H352V144z"/></svg>
                                                    </button>
                                                }
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <div class="mt-6 flex justify-center">
                        <Pagination CurrentPage="@currentPage" TotalItems="@totalRecords" ItemsPerPage="@pageSize" OnPageChanged="@OnPageChanged" />
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Detail Modal -->
@if (showDetailModal && selectedCustomer != null)
{
    <div class="modal fade show d-flex align-items-center justify-content-center" tabindex="-1" role="dialog" aria-modal="true" style="display:flex !important; background:rgba(0,0,0,0.5);" @onclick="CloseDetailModal">
        <div class="modal-dialog modal-lg" role="document" @onclick:stopPropagation>
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="18" height="18" fill="#0891b2">
                            <path d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"/>
                        </svg>
                        Chi tiết khách hàng
                    </h5>
                    <button type="button" class="btn-close" aria-label="Đóng" @onclick="CloseDetailModal"></button>
                </div>

                <div class="modal-body">
                    <!-- Customer Avatar & Name -->
                    <div class="d-flex align-items-center gap-3 mb-4 pb-3 border-bottom">
                        <div>
                            @if (!string.IsNullOrEmpty(selectedCustomer.Picture))
                            {
                                <img src="@selectedCustomer.Picture" alt="@selectedCustomer.UserName" class="rounded-circle" style="width:80px;height:80px;object-fit:cover;" />
                            }
                            else
                            {
                                <div class="rounded-circle d-flex align-items-center justify-center text-white fw-bold" style="width:80px;height:80px;background:#0891b2;font-size:2rem;">
                                    @GetInitials(selectedCustomer.UserName)
                                </div>
                            }
                        </div>
                        <div class="flex-grow-1">
                            <h4 class="mb-1 fw-bold">@selectedCustomer.UserName</h4>
                            <div class="d-flex align-items-center gap-2 flex-wrap">
                                <span class="badge bg-cyan-100 text-cyan-700">Khách hàng</span>
                                <span class="badge @GetStatusClass(selectedCustomer.Status)">@GetStatusText(selectedCustomer.Status)</span>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3">
                        <!-- Contact Info -->
                        <div class="col-md-6">
                            <div class="detail-info-row">
                                <div class="detail-info-label">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="12" height="12" fill="currentColor" class="me-1"><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"/></svg>
                                    Email
                                </div>
                                <div class="detail-info-value">@selectedCustomer.Email</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-info-row">
                                <div class="detail-info-label">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="12" height="12" fill="currentColor" class="me-1"><path d="M164.9 24.6c-7.7-18.6-28-28.5-47.4-23.2l-88 24C12.1 30.2 0 46 0 64C0 311.4 200.6 512 448 512c18 0 33.8-12.1 38.6-29.5l24-88c5.3-19.4-4.6-39.7-23.2-47.4l-96-40c-16.3-6.8-35.2-2.1-46.3 11.6L304.7 368C234.3 334.7 177.3 277.7 144 207.3L193.3 167c13.7-11.2 18.4-30 11.6-46.3l-40-96z"/></svg>
                                    Điện thoại
                                </div>
                                <div class="detail-info-value">@selectedCustomer.PhoneNumber</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-info-row">
                                <div class="detail-info-label">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="12" height="12" fill="currentColor" class="me-1"><path d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24z"/></svg>
                                    Ngày sinh
                                </div>
                                <div class="detail-info-value">@(selectedCustomer.DateOfBirth?.ToString("dd/MM/yyyy") ?? "Chưa cập nhật")</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-info-row">
                                <div class="detail-info-label">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="12" height="12" fill="currentColor" class="me-1"><path d="M256 0a256 256 0 1 1 0 512A256 256 0 1 1 256 0zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"/></svg>
                                    Ngày tham gia
                                </div>
                                <div class="detail-info-value">@selectedCustomer.CreatedAt.ToString("dd/MM/yyyy HH:mm")</div>
                            </div>
                        </div>
                    </div>

                    @if (selectedCustomer.Address != null && selectedCustomer.Address.Any())
                    {
                        <div class="mt-4">
                            <h6 class="fw-bold mb-3">Địa chỉ giao hàng</h6>
                            @foreach (var addr in selectedCustomer.Address)
                            {
                                <div class="alert alert-light mb-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" width="12" height="12" fill="currentColor" class="me-2"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>
                                    <strong>@addr.AddressDetail</strong><br/>
                                    <small class="text-muted">@addr.Street, @addr.Ward, @addr.District, @addr.City</small>
                                </div>
                            }
                        </div>
                    }
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CloseDetailModal">Đóng</button>
                    @if (selectedCustomer.Status == 1)
                    {
                        <button type="button" class="btn btn-danger" @onclick="() => { CloseDetailModal(); ConfirmStatusChange(selectedCustomer, 0); }">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="12" height="12" fill="currentColor"><path d="M144 144v48H304V144c0-44.2-35.8-80-80-80s-80 35.8-80 80zM80 192V144C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64H80z"/></svg>
                            Khóa tài khoản
                        </button>
                    }
                    else
                    {
                        <button type="button" class="btn btn-success" @onclick="() => { CloseDetailModal(); ConfirmStatusChange(selectedCustomer, 1); }">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" width="12" height="12" fill="currentColor"><path d="M352 144c0-44.2 35.8-80 80-80s80 35.8 80 80v48c0 17.7 14.3 32 32 32s32-14.3 32-32V144C576 64.5 511.5 0 432 0S288 64.5 288 144v48H64c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V256c0-35.3-28.7-64-64-64H352V144z"/></svg>
                            Mở khóa
                        </button>
                    }
                </div>
            </div>
        </div>
    </div>
}

<!-- Status Change Confirm Modal -->
@if (showStatusConfirm && customerToChange != null)
{
    <div class="modal fade show d-flex align-items-center justify-content-center" tabindex="-1" style="display:flex !important; background:rgba(0,0,0,0.5);" @onclick="CloseStatusConfirm">
        <div class="modal-dialog modal-sm" @onclick:stopPropagation>
            <div class="modal-content">
                <div class="modal-header @(newStatus == 0 ? "bg-danger" : "bg-success") text-white py-2 px-3">
                    <h5 class="modal-title">Xác nhận @(newStatus == 0 ? "khóa" : "mở khóa")</h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="CloseStatusConfirm"></button>
                </div>
                <div class="modal-body py-3">
                    <p class="mb-2">Bạn có chắc chắn muốn <strong>@(newStatus == 0 ? "khóa" : "mở khóa")</strong> tài khoản:</p>
                    <div class="alert @(newStatus == 0 ? "alert-danger" : "alert-success") mb-0 p-2">
                        <strong>@customerToChange.UserName</strong><br/>
                        <small>@customerToChange.Email</small>
                    </div>
                </div>
                <div class="modal-footer py-2 px-3">
                    <button type="button" class="btn btn-sm btn-secondary" @onclick="CloseStatusConfirm">Hủy</button>
                    <button type="button" class="btn btn-sm @(newStatus == 0 ? "btn-danger" : "btn-success")" disabled="@isChanging" @onclick="ChangeStatusAsync">
                        @(isChanging ? "Đang xử lý..." : "Xác nhận")
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private List<GetListUserRes> customers = new();
    private int totalRecords = 0;
    private int currentPage = 1;
    private int pageSize = 10;
    private bool loading = true;

    private string searchKeyword = string.Empty;
    private string filterStatus = string.Empty;

    // Detail modal
    private bool showDetailModal = false;
    private GetListUserRes? selectedCustomer;

    // Status change modal
    private bool showStatusConfirm = false;
    private GetListUserRes? customerToChange;
    private int newStatus = 0;
    private bool isChanging = false;

    protected override async Task OnInitializedAsync()
    {
        await LoadCustomers();
    }

    private async Task LoadCustomers()
    {
        loading = true;
        
        int? statusFilter = null;
        if (!string.IsNullOrWhiteSpace(filterStatus))
            statusFilter = int.Parse(filterStatus);

        var response = await UserService.GetListUserAsync(
            currentPage,
            pageSize,
            searchKeyword,
            statusFilter,
            string.Empty,
            string.Empty
        );

        if (response.Success)
        {
            customers = response.Data;
            totalRecords = response.TotalRecords;
        }
        else
        {
            Toast.Error(response.Message);
        }

        loading = false;
    }

    private async Task OnPageChanged(int page)
    {
        currentPage = page;
        await LoadCustomers();
    }

    private async Task SearchCustomers()
    {
        currentPage = 1;
        await LoadCustomers();
    }

    private async Task ClearSearch()
    {
        searchKeyword = string.Empty;
        currentPage = 1;
        await LoadCustomers();
    }

    private async Task HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await SearchCustomers();
        }
    }

    private void OpenDetailModal(GetListUserRes customer)
    {
        selectedCustomer = customer;
        showDetailModal = true;
    }

    private void CloseDetailModal()
    {
        showDetailModal = false;
        selectedCustomer = null;
    }

    private void ConfirmStatusChange(GetListUserRes customer, int status)
    {
        customerToChange = customer;
        newStatus = status;
        showStatusConfirm = true;
    }

    private void CloseStatusConfirm()
    {
        showStatusConfirm = false;
        customerToChange = null;
    }

    private async Task ChangeStatusAsync()
    {
        if (isChanging || customerToChange == null) return;

        isChanging = true;
        var result = await UserService.ChangeUserStatusAsync(customerToChange.Id, newStatus);
        
        if (result.Success)
        {
            Toast.Success(result.Message);
            CloseStatusConfirm();
            await LoadCustomers();
        }
        else
        {
            Toast.Error(result.Message);
        }
        
        isChanging = false;
    }

    private string GetInitials(string name)
    {
        if (string.IsNullOrWhiteSpace(name)) return "?";
        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        if (parts.Length >= 2)
            return $"{parts[0][0]}{parts[^1][0]}".ToUpper();
        return name[0].ToString().ToUpper();
    }

    private string GetStatusClass(int status) => status switch
    {
        1 => "bg-emerald-100 text-emerald-600",
        0 => "bg-red-100 text-red-600",
        _ => "bg-gray-100 text-gray-600"
    };

    private string GetStatusText(int status) => status switch
    {
        1 => "Hoạt động",
        0 => "Đã khóa",
        _ => "Không xác định"
    };
}
